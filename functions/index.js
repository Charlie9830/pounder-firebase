!function(t){var e={};function o(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=t,o.c=e,o.d=function(t,e,r){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)o.d(r,s,function(e){return t[e]}.bind(null,s));return r},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=3)}([function(t,e,o){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});e.DatabaseStore=function t(e,o,s,i,c){r(this,t),this.projects=e,this.projectLayouts=o,this.taskLists=s,this.tasks=i,this.accountConfig=c},e.ProjectStore=function t(e,o,s){r(this,t),this.projectName=e,this.uid=o,this.isRemote=s},e.RemoteStore=function t(e,o,s,i,c,n){r(this,t),this.projectName=e,this.uid=o,this.members=s,this.projectLayout=i,this.taskLists=c,this.tasks=n},e.MemberStore=function t(e,o,s,i,c,n){r(this,t),this.project=o,this.userId=e,this.displayName=s,this.email=i,this.status=c,this.role=n},e.ProjectLayoutStore=function t(e,o,s){r(this,t),this.layouts=e,this.project=o,this.uid=s},e.TaskListSettingsStore=function t(e,o){r(this,t),this.isCompleteTasksShown=e,this.sortBy=o},e.TaskListStore=function t(e,o,s,i,c){r(this,t),this.taskListName=e,this.project=o,this.uid=s,this.taskListId=i,this.settings=c},e.TaskStore=function t(e,o,s,i,c,n,a,l,u,d){r(this,t),this.taskName=e,this.dueDate=o,this.isComplete=s,this.project=i,this.taskList=c,this.uid=n,this.dateAdded=a,this.isNewTask=l,this.isHighPriority=u,this.metadata=d},e.AccountStore=function t(e,o){r(this,t),this.uid=e,this.favourteProjectId=o},e.DirectoryStore=function t(e,o,s){r(this,t),this.email=e,this.displayName=o,this.userId=s},e.InviteStore=function t(e,o,s,i,c,n,a){r(this,t),this.projectName=e,this.targetUserId=o,this.sourceUserId=s,this.sourceEmail=i,this.sourceDisplayName=c,this.projectId=n,this.role=a},e.TaskMetadataStore=function t(e,o,s,i,c){r(this,t),this.createdBy=e,this.createdOn=o,this.updatedBy=s,this.updatedOn=i,this.completedBy=c},e.CssConfigStore={"--primary-color":"","--background-color":"","--surface-color":"","--surface-color-alternate":"","--primary-button-background-image":"","--primary-active-text-color":"","--primary-inactive-text-color":"","--primary-hover-color":"","--alternate-active-text-color":"","--alternate-inactive-text-color":"","--loading-spinner-primary-color":"","--loading-spinner-secondary-color":"","--task-checkbox-color":"","--task-text-color":"","--task-selected-color":"","--task-hover-color":"","--task-divider-color":"","--overdue-color":"","--soon-color":"","--later-color":"","--today-color":"","--important-color":"","--due-date-text-color":"","--due-date-circle-color":"","--task-list-header-text-color":"","--task-list-selected-border-color":"","--task-list-selected-header-color":"","--database-synced-color":"","--database-updates-pending-color":""}},function(t,e){t.exports=require("firebase-admin")},function(t,e){t.exports=require("firebase-functions")},function(t,e,o){"use strict";o.r(e),o.d(e,"DIRECTORY",function(){return c}),o.d(e,"USERS",function(){return n}),o.d(e,"TASKS",function(){return a}),o.d(e,"TASKLISTS",function(){return l}),o.d(e,"PROJECTS",function(){return u}),o.d(e,"PROJECTLAYOUTS",function(){return d}),o.d(e,"ACCOUNT",function(){return h}),o.d(e,"ACCOUNT_DOC_ID",function(){return p}),o.d(e,"INVITES",function(){return f}),o.d(e,"REMOTES",function(){return m}),o.d(e,"REMOTE_IDS",function(){return y}),o.d(e,"MEMBERS",function(){return g});var r=o(0);const s=o(2),i=o(1),c="directory",n="users",a="tasks",l="taskLists",u="projects",d="projectLayouts",h="account",p="primary",f="invites",m="remotes",y="remoteIds",g="members";i.initializeApp({credential:i.credential.applicationDefault(),databaseURL:"https://halo-todo.firebaseio.com"}),exports.addUserToDirectory=s.auth.user().onCreate(t=>{i.firestore().collection(c).doc(t.email).set(Object.assign({},new r.DirectoryStore(t.email.toLowerCase(),t.displayName,t.uid))).then(()=>{})}),exports.removeUserFromDirectory=s.auth.user().onDelete(t=>{i.firestore().collection(c).doc(t.email).delete().then(()=>{})}),exports.getRemoteUserData=s.https.onCall((t,e)=>{var o=t.targetEmail;return i.firestore().collection(c).doc(o).get().then(t=>t.exists?{status:"user found",userData:t.data()}:{status:"user not found",userData:{}})}),exports.sendProjectInvite=s.https.onCall((t,e)=>{var o=t.projectName,s=t.sourceEmail,c=t.sourceDisplayName,a=t.projectId,l=t.targetUserId,u=t.targetDisplayName,d=t.targetEmail,h=e.auth.uid,p=t.role,y=new r.InviteStore(o,l,h,s,c,a,p);return i.firestore().collection(n).doc(l).collection(f).doc(a).set(Object.assign({},y)).then(()=>{var t=new r.MemberStore(l,a,u,d,"pending",p);return i.firestore().collection(m).doc(a).collection(g).doc(l).set(Object.assign({},t)).then(()=>({status:"complete"})).catch(t=>({status:"error",error:"Error while setting user into members: "+t.message}))}).catch(t=>({status:"error",error:t.message}))}),exports.kickUserFromProject=s.https.onCall((t,e)=>{var o=t.projectId,r=t.userId,s=i.firestore().batch();return s.delete(i.firestore().collection(m).doc(o).collection(g).doc(r)),s.delete(i.firestore().collection(n).doc(r).collection(y).doc(o)),s.delete(i.firestore().collection(n).doc(r).collection(f).doc(o)),s.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while Kicking user: "+t.message}))}),exports.kickAllUsersFromProject=s.https.onCall((t,e)=>{var o=t.projectId;return i.firestore().collection(m).doc(o).collection(g).get().then(t=>{if(!0!==t.empty){var e=i.firestore().batch();return t.forEach(t=>{e.delete(i.firestore().collection(m).doc(o).collection(g).doc(t.id)),e.delete(i.firestore().collection(n).doc(t.id).collection(y).doc(o)),e.delete(i.firestore().collection(n).doc(t.id).collection(f).doc(o))}),e.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while Kicking user: "+t.message}))}return{status:"error",message:"Project has no contributors to kick."}})}),exports.acceptProjectInvite=s.https.onCall((t,e)=>{var o=t.projectId,r=e.auth.uid,s=i.firestore().batch(),c=i.firestore().collection(m).doc(o).collection(g).doc(r);s.update(c,{status:"added"});var a=i.firestore().collection(n).doc(r).collection(y).doc(o);return s.set(a,{projectId:o}),s.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured accepting project invite. "+t.message}))}),exports.denyProjectInvite=s.https.onCall((t,e)=>{var o=t.projectId,r=e.auth.uid;return i.firestore().collection(m).doc(o).collection(g).doc(r).update({status:"rejected invite"}).then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured whilst denying project invite."+t.message}))}),exports.removeRemoteProject=s.https.onCall((t,e)=>{var o=t.projectId,r=e.auth.uid,s=i.firestore().batch();return s.delete(i.firestore().collection(m).doc(o)),s.delete(i.firestore().collection(n).doc(r).collection(y).doc(o)),s.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:t.message}))})}]);