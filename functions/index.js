!function(t){var e={};function r(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(o,s,function(e){return t[e]}.bind(null,s));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.DIRECTORY="directory",e.USERS="users",e.TASKS="tasks",e.TASKLISTS="taskLists",e.PROJECTS="projects",e.PROJECTLAYOUTS="projectLayouts",e.ACCOUNT="account",e.ACCOUNT_DOC_ID="primary",e.INVITES="invites",e.REMOTES="remotes",e.REMOTE_IDS="remoteIds",e.MEMBERS="members"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}();var s=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===e||null===e)throw"An instance of the Firestore library must be provided to the contructor";this.firestore=e,this.currentEntryCount=0,this.currentBatchIndex=0,this.batches=[],this.batches.push(this.firestore.batch())}return o(t,[{key:"create",value:function(t,e){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,this.batches[this.currentBatchIndex].create(t,e)}},{key:"delete",value:function(t,e){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,void 0!==e?this.batches[this.currentBatchIndex].delete(t,e):this.batches[this.currentBatchIndex].delete(t)}},{key:"set",value:function(t,e,r){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,this.batches[this.currentBatchIndex].set(t,e,r)}},{key:"update",value:function(t,e,r){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,void 0!==r?this.batches[this.currentBatchIndex].update(t,e,r):this.batches[this.currentBatchIndex].update(t,e)}},{key:"commit",value:function(){var t=this;return new Promise(function(e,r){var o=[];t.batches.forEach(function(t){o.push(t.commit())}),Promise.all(o).then(function(){e()}).catch(function(t){r(t)})})}},{key:"createNewBatch",value:function(){var t=this.batches.push(this.firestore.batch())-1;this.currentBatchIndex=t,this.currentEntryCount=0}},{key:"isBatchFull",value:function(){return this.currentEntryCount>=500}}]),t}();e.default=s},function(t,e,r){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.ProjectFactory=function(t,e,r,o,s){var c=void 0===o?"":o,i=void 0===s?"":s;return{projectName:t,uid:e,isRemote:r,created:c,updated:i}},e.ChecklistSettingsFactory=function(t,e,r,o){return{isChecklist:t,initialStartDate:e,lastRenewDate:r,renewInterval:o}},e.GetFreshLayout=function(t){return{i:t,x:0,y:0,w:6,h:4,isFresh:!0}};e.DatabaseStore=function t(e,r,s,c,i){o(this,t),this.projects=e,this.projectLayouts=r,this.taskLists=s,this.tasks=c,this.accountConfig=i},e.ProjectStore=function t(e,r,s,c,i){o(this,t),this.projectName=e,this.uid=r,this.isRemote=s,this.created=c,this.updated=i};e.RemoteStore=function t(e,r,s,c,i,a){o(this,t),this.projectName=e,this.uid=r,this.members=s,this.projectLayout=c,this.taskLists=i,this.tasks=a},e.MemberStore=function t(e,r,s,c,i,a){o(this,t),this.project=r,this.userId=e,this.displayName=s,this.email=c,this.status=i,this.role=a},e.ProjectLayoutStore=function t(e,r,s){o(this,t),this.layouts=e,this.project=r,this.uid=s},e.TaskListSettingsStore=function t(e,r,s){o(this,t),this.isCompleteTasksShown=e,this.sortBy=r,this.checklistSettings=s};e.TaskListStore=function t(e,r,s,c,i,a){o(this,t),this.taskListName=e,this.project=r,this.uid=s,this.taskListId=c,this.settings=i,this.isFresh=a},e.TaskStore=function t(e,r,s,c,i,a,n,l,u,h,d){o(this,t),this.taskName=e,this.dueDate=r,this.isComplete=s,this.project=c,this.taskList=i,this.uid=a,this.dateAdded=n,this.isNewTask=l,this.isHighPriority=u,this.metadata=h,this.assignedTo=d},e.AccountStore=function t(e,r){o(this,t),this.uid=e,this.favourteProjectId=r},e.DirectoryStore=function t(e,r,s){o(this,t),this.email=e,this.displayName=r,this.userId=s},e.InviteStore=function t(e,r,s,c,i,a,n){o(this,t),this.projectName=e,this.targetUserId=r,this.sourceUserId=s,this.sourceEmail=c,this.sourceDisplayName=i,this.projectId=a,this.role=n},e.TaskMetadataStore=function t(e,r,s,c,i,a){o(this,t),this.createdBy=e,this.createdOn=r,this.updatedBy=s,this.updatedOn=c,this.completedBy=i,this.completedOn=a};e.CssConfigStore={"--primary-color":"","--background-color":"","--surface-color":"","--surface-color-alternate":"","--primary-active-text-color":"","--primary-inactive-text-color":"","--primary-hover-color":"","--primary-divider-color":"","--alternate-active-text-color":"","--alternate-inactive-text-color":"","--loading-spinner-primary-color":"","--loading-spinner-secondary-color":"","--button-background-top-color":"","--button-background-bottom-color":"","--task-checkbox-color":"","--task-text-color":"","--task-selected-color":"","--task-hover-color":"","--task-divider-color":"","--overdue-color":"","--soon-color":"","--later-color":"","--today-color":"","--important-color":"","--due-date-text-color":"","--due-date-circle-color":"","--assignee-background-color":"","--assignee-text-color":"","--task-list-header-text-color":"","--task-list-header-selected-text-color":"","--task-list-header-background-color":"","--task-list-header-background-selected-color":"","--scrollbar-track-color":"","--scrollbar-thumb-color":"","--database-synced-color":"","--database-updates-pending-color":""}},function(t,e){t.exports=require("firebase-admin")},function(t,e){t.exports=require("firebase-functions")},function(t,e,r){"use strict";r.r(e);var o=r(2),s=r(0),c=r(1),i=r.n(c);const a=r(4),n=r(3);function l(t){return new Promise((e,r)=>{var o=[];t.get().then(t=>{!0!==t.empty?(t.forEach(t=>{o.push(t.ref)}),function(t){return new Promise((e,r)=>{var o=new i.a(n.firestore());t.forEach(t=>{o.delete(t)}),o.commit().then(()=>{e()}).catch(t=>{r(t)})})}(o).then(()=>{e()}).catch(t=>{r(t)})):e()})})}n.initializeApp({credential:n.credential.applicationDefault(),databaseURL:"https://halo-todo.firebaseio.com"}),exports.removeUserFromDirectory=a.auth.user().onDelete(t=>n.firestore().collection(s.DIRECTORY).doc(t.email).delete().then(()=>{})),exports.removeLocalTasksOrphanedFromTaskLists=a.firestore.document("users/{userId}/taskLists/{taskListId}").onDelete((t,e)=>{var r=e.params.userId,o=e.params.taskListId;return l(n.firestore().collection(s.USERS).doc(r).collection(s.TASKS).where("taskList","==",o))}),exports.removeRemoteTasksOrphanedFromTaskLists=a.firestore.document("remotes/{projectId}/taskLists/{taskListId}").onDelete((t,e)=>{var r=e.params.projectId,o=e.params.taskListId;return l(n.firestore().collection(s.REMOTES).doc(r).collection(s.TASKS).where("taskList","==",o))}),exports.getRemoteUserData=a.https.onCall((t,e)=>{var r=t.targetEmail;return n.firestore().collection(s.DIRECTORY).doc(r).get().then(t=>t.exists?{status:"user found",userData:t.data()}:{status:"user not found",userData:{}})}),exports.sendProjectInvite=a.https.onCall((t,e)=>{var r=t.projectName,c=t.sourceEmail,i=t.sourceDisplayName,a=t.projectId,l=t.targetUserId,u=t.targetDisplayName,h=t.targetEmail,d=e.auth.uid,f=t.role,p=new o.InviteStore(r,l,d,c,i,a,f);return n.firestore().collection(s.USERS).doc(l).collection(s.INVITES).doc(a).set(Object.assign({},p)).then(()=>{var t=new o.MemberStore(l,a,u,h,"pending",f);return n.firestore().collection(s.REMOTES).doc(a).collection(s.MEMBERS).doc(l).set(Object.assign({},t)).then(()=>({status:"complete"})).catch(t=>({status:"error",error:"Error while setting user into members: "+t.message}))}).catch(t=>({status:"error",error:t.message}))}),exports.kickUserFromProject=a.https.onCall((t,e)=>{var r=t.projectId,o=t.userId,c=n.firestore().batch();return c.delete(n.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(o)),c.delete(n.firestore().collection(s.USERS).doc(o).collection(s.REMOTE_IDS).doc(r)),c.delete(n.firestore().collection(s.USERS).doc(o).collection(s.INVITES).doc(r)),c.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while Kicking user: "+t.message}))}),exports.kickAllUsersFromProject=a.https.onCall((t,e)=>{var r=t.projectId;return n.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).get().then(t=>{if(!0!==t.empty){var e=n.firestore().batch();return t.forEach(t=>{e.delete(n.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(t.id)),e.delete(n.firestore().collection(s.USERS).doc(t.id).collection(s.REMOTE_IDS).doc(r)),e.delete(n.firestore().collection(s.USERS).doc(t.id).collection(s.INVITES).doc(r))}),e.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while Kicking user: "+t.message}))}return{status:"error",message:"Project has no contributors to kick."}})}),exports.acceptProjectInvite=a.https.onCall((t,e)=>{var r=t.projectId,o=e.auth.uid;return n.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).get().then(t=>{var e=[];if(t.forEach(t=>{e.push(t.data())}),-1!==e.findIndex(t=>t.userId===o)){var c=n.firestore().batch(),i=n.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(o);c.update(i,{status:"added"});var a=n.firestore().collection(s.USERS).doc(o).collection(s.REMOTE_IDS).doc(r);return c.set(a,{projectId:r}),c.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while accepting project invite. "+t.message}))}}).catch(t=>({status:"error",message:"Error occured while validating project invite. "+t.message}))}),exports.denyProjectInvite=a.https.onCall((t,e)=>{var r=t.projectId,o=e.auth.uid;return n.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(o).update({status:"rejected invite"}).then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured whilst denying project invite."+t.message}))}),exports.removeRemoteProject=a.https.onCall((t,e)=>{var r=t.projectId,o=(e.auth.uid,[]),c=[],a=[],l=[],u=[],h=[],d=n.firestore().collection(s.REMOTES).doc(r);return o.push(d.collection(s.PROJECTLAYOUTS).get().then(t=>{t.forEach(t=>{c.push(t.ref)})})),o.push(d.collection(s.TASKLISTS).get().then(t=>{t.forEach(t=>{a.push(t.ref)})})),o.push(d.collection(s.TASKS).get().then(t=>{t.forEach(t=>{l.push(t.ref)})})),o.push(d.collection(s.MEMBERS).get().then(t=>{t.forEach(t=>{h.push(t.ref),u.push(t.id)})})),Promise.all(o).then(()=>{var t=new i.a(n.firestore());return c.forEach(e=>{t.delete(e)}),a.forEach(e=>{t.delete(e)}),l.forEach(e=>{t.delete(e)}),h.forEach(e=>{t.delete(e)}),u.forEach(e=>{var o=n.firestore().collection(s.USERS).doc(e).collection(s.REMOTE_IDS).doc(r);t.delete(o);var c=n.firestore().collection(s.USERS).doc(e).collection(s.INVITES).doc(r);t.delete(c)}),t.delete(d),t.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:t.message}))})})}]);