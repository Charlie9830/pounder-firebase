!function(t){var e={};function r(o){if(e[o])return e[o].exports;var s=e[o]={i:o,l:!1,exports:{}};return t[o].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,o){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(o,s,function(e){return t[e]}.bind(null,s));return o},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=5)}([function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.DIRECTORY="directory",e.USERS="users",e.TASKS="tasks",e.TASKLISTS="taskLists",e.PROJECTS="projects",e.PROJECTLAYOUTS="projectLayouts",e.ACCOUNT="account",e.ACCOUNT_DOC_ID="primary",e.INVITES="invites",e.REMOTES="remotes",e.REMOTE_IDS="remoteIds",e.MEMBERS="members"},function(t,e,r){"use strict";function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.GetFreshLayout=function(t){return{i:t,x:0,y:0,w:6,h:4,isFresh:!0}};e.DatabaseStore=function t(e,r,s,c,i){o(this,t),this.projects=e,this.projectLayouts=r,this.taskLists=s,this.tasks=c,this.accountConfig=i},e.ProjectStore=function t(e,r,s){o(this,t),this.projectName=e,this.uid=r,this.isRemote=s},e.RemoteStore=function t(e,r,s,c,i,n){o(this,t),this.projectName=e,this.uid=r,this.members=s,this.projectLayout=c,this.taskLists=i,this.tasks=n},e.MemberStore=function t(e,r,s,c,i,n){o(this,t),this.project=r,this.userId=e,this.displayName=s,this.email=c,this.status=i,this.role=n},e.ProjectLayoutStore=function t(e,r,s){o(this,t),this.layouts=e,this.project=r,this.uid=s},e.TaskListSettingsStore=function t(e,r){o(this,t),this.isCompleteTasksShown=e,this.sortBy=r},e.TaskListStore=function t(e,r,s,c,i,n){o(this,t),this.taskListName=e,this.project=r,this.uid=s,this.taskListId=c,this.settings=i,this.isFresh=n},e.TaskStore=function t(e,r,s,c,i,n,a,l,u,h,d){o(this,t),this.taskName=e,this.dueDate=r,this.isComplete=s,this.project=c,this.taskList=i,this.uid=n,this.dateAdded=a,this.isNewTask=l,this.isHighPriority=u,this.metadata=h,this.assignedTo=d},e.AccountStore=function t(e,r){o(this,t),this.uid=e,this.favourteProjectId=r},e.DirectoryStore=function t(e,r,s){o(this,t),this.email=e,this.displayName=r,this.userId=s},e.InviteStore=function t(e,r,s,c,i,n,a){o(this,t),this.projectName=e,this.targetUserId=r,this.sourceUserId=s,this.sourceEmail=c,this.sourceDisplayName=i,this.projectId=n,this.role=a},e.TaskMetadataStore=function t(e,r,s,c,i){o(this,t),this.createdBy=e,this.createdOn=r,this.updatedBy=s,this.updatedOn=c,this.completedBy=i};e.CssConfigStore={"--primary-color":"","--background-color":"","--surface-color":"","--surface-color-alternate":"","--primary-active-text-color":"","--primary-inactive-text-color":"","--primary-hover-color":"","--alternate-active-text-color":"","--alternate-inactive-text-color":"","--loading-spinner-primary-color":"","--loading-spinner-secondary-color":"","--button-background-top-color":"","--button-background-bottom-color":"","--task-checkbox-color":"","--task-text-color":"","--task-selected-color":"","--task-hover-color":"","--task-divider-color":"","--overdue-color":"","--soon-color":"","--later-color":"","--today-color":"","--important-color":"","--due-date-text-color":"","--due-date-circle-color":"","--assignee-background-color":"","--assignee-text-color":"","--task-list-header-text-color":"","--task-list-header-selected-text-color":"","--task-list-header-background-color":"","--task-list-header-background-selected-color":"","--database-synced-color":"","--database-updates-pending-color":""}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}();var s=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),void 0===e||null===e)throw"An instance of the Firestore library must be provided to the contructor";this.firestore=e,this.currentEntryCount=0,this.currentBatchIndex=0,this.batches=[],this.batches.push(this.firestore.batch())}return o(t,[{key:"create",value:function(t,e){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,this.batches[this.currentBatchIndex].create(t,e)}},{key:"delete",value:function(t,e){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,void 0!==e?this.batches[this.currentBatchIndex].delete(t,e):this.batches[this.currentBatchIndex].delete(t)}},{key:"set",value:function(t,e,r){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,this.batches[this.currentBatchIndex].set(t,e,r)}},{key:"update",value:function(t,e,r){return this.isBatchFull()&&this.createNewBatch(),this.currentEntryCount++,void 0!==r?this.batches[this.currentBatchIndex].update(t,e,r):this.batches[this.currentBatchIndex].update(t,e)}},{key:"commit",value:function(){var t=this;return new Promise(function(e,r){var o=[];t.batches.forEach(function(t){o.push(t.commit())}),Promise.all(o).then(function(){e()}).catch(function(t){r(t)})})}},{key:"createNewBatch",value:function(){var t=this.batches.push(this.firestore.batch())-1;this.currentBatchIndex=t,this.currentEntryCount=0}},{key:"isBatchFull",value:function(){return this.currentEntryCount>=500}}]),t}();e.default=s},function(t,e){t.exports=require("firebase-admin")},function(t,e){t.exports=require("firebase-functions")},function(t,e,r){"use strict";r.r(e);var o=r(1),s=r(0),c=r(2),i=r.n(c);const n=r(4),a=r(3);a.initializeApp({credential:a.credential.applicationDefault(),databaseURL:"https://halo-todo.firebaseio.com"}),exports.removeUserFromDirectory=n.auth.user().onDelete(t=>{a.firestore().collection(s.DIRECTORY).doc(t.email).delete().then(()=>{})}),exports.getRemoteUserData=n.https.onCall((t,e)=>{var r=t.targetEmail;return a.firestore().collection(s.DIRECTORY).doc(r).get().then(t=>t.exists?{status:"user found",userData:t.data()}:{status:"user not found",userData:{}})}),exports.sendProjectInvite=n.https.onCall((t,e)=>{var r=t.projectName,c=t.sourceEmail,i=t.sourceDisplayName,n=t.projectId,l=t.targetUserId,u=t.targetDisplayName,h=t.targetEmail,d=e.auth.uid,f=t.role,p=new o.InviteStore(r,l,d,c,i,n,f);return a.firestore().collection(s.USERS).doc(l).collection(s.INVITES).doc(n).set(Object.assign({},p)).then(()=>{var t=new o.MemberStore(l,n,u,h,"pending",f);return a.firestore().collection(s.REMOTES).doc(n).collection(s.MEMBERS).doc(l).set(Object.assign({},t)).then(()=>({status:"complete"})).catch(t=>({status:"error",error:"Error while setting user into members: "+t.message}))}).catch(t=>({status:"error",error:t.message}))}),exports.kickUserFromProject=n.https.onCall((t,e)=>{var r=t.projectId,o=t.userId,c=a.firestore().batch();return c.delete(a.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(o)),c.delete(a.firestore().collection(s.USERS).doc(o).collection(s.REMOTE_IDS).doc(r)),c.delete(a.firestore().collection(s.USERS).doc(o).collection(s.INVITES).doc(r)),c.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while Kicking user: "+t.message}))}),exports.kickAllUsersFromProject=n.https.onCall((t,e)=>{var r=t.projectId;return a.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).get().then(t=>{if(!0!==t.empty){var e=a.firestore().batch();return t.forEach(t=>{e.delete(a.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(t.id)),e.delete(a.firestore().collection(s.USERS).doc(t.id).collection(s.REMOTE_IDS).doc(r)),e.delete(a.firestore().collection(s.USERS).doc(t.id).collection(s.INVITES).doc(r))}),e.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while Kicking user: "+t.message}))}return{status:"error",message:"Project has no contributors to kick."}})}),exports.acceptProjectInvite=n.https.onCall((t,e)=>{var r=t.projectId,o=e.auth.uid;return a.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).get().then(t=>{var e=[];if(t.forEach(t=>{e.push(t.data())}),-1!==e.findIndex(t=>t.userId===o)){var c=a.firestore().batch(),i=a.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(o);c.update(i,{status:"added"});var n=a.firestore().collection(s.USERS).doc(o).collection(s.REMOTE_IDS).doc(r);return c.set(n,{projectId:r}),c.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured while accepting project invite. "+t.message}))}}).catch(t=>({status:"error",message:"Error occured while validating project invite. "+t.message}))}),exports.denyProjectInvite=n.https.onCall((t,e)=>{var r=t.projectId,o=e.auth.uid;return a.firestore().collection(s.REMOTES).doc(r).collection(s.MEMBERS).doc(o).update({status:"rejected invite"}).then(()=>({status:"complete"})).catch(t=>({status:"error",message:"Error occured whilst denying project invite."+t.message}))}),exports.removeRemoteProject=n.https.onCall((t,e)=>{var r=t.projectId,o=(e.auth.uid,[]),c=[],n=[],l=[],u=[],h=[],d=a.firestore().collection(s.REMOTES).doc(r);return o.push(d.collection(s.PROJECTLAYOUTS).get().then(t=>{t.forEach(t=>{c.push(t.ref)})})),o.push(d.collection(s.TASKLISTS).get().then(t=>{t.forEach(t=>{n.push(t.ref)})})),o.push(d.collection(s.TASKS).get().then(t=>{t.forEach(t=>{l.push(t.ref)})})),o.push(d.collection(s.MEMBERS).get().then(t=>{t.forEach(t=>{h.push(t.ref),u.push(t.id)})})),Promise.all(o).then(()=>{var t=new i.a(a.firestore());return c.forEach(e=>{t.delete(e)}),n.forEach(e=>{t.delete(e)}),l.forEach(e=>{t.delete(e)}),h.forEach(e=>{t.delete(e)}),u.forEach(e=>{var o=a.firestore().collection(s.USERS).doc(e).collection(s.REMOTE_IDS).doc(r);t.delete(o);var c=a.firestore().collection(s.USERS).doc(e).collection(s.INVITES).doc(r);t.delete(c)}),t.delete(d),t.commit().then(()=>({status:"complete"})).catch(t=>({status:"error",message:t.message}))})})}]);